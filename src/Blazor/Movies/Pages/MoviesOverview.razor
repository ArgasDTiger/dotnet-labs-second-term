@page "/movies"
@using Blazor.Core.Models
@using Blazor.Shared.Components.Modal
@using Blazor.Shared.Components.CardItem
@rendermode InteractiveServer

<h3>Movies</h3>

<div class="card-container">
    @foreach (var movie in Movies)
    {
        <CardItem TItem="Movie"
                  Item="movie"
                  ShowDetails="false"
                  ShowEdit="true"
                  ShowDelete="true"
                  OnEditClick="@((Movie m) => OpenEditModal(m))"
                  OnDeleteClick="@((Movie m) => OpenDeleteModal(m))">
            
            <HeaderContent>
                @movie.Title
            </HeaderContent>
            
            <MiddleContent>
                @movie.Description
            </MiddleContent>
            
            <ListContent>
                <li class="subject-item">
                    <div class="header">Price per day:</div>
                    <div class="value">@movie.PricePerDay</div>
                </li>
                <li class="subject-item">
                    <div class="header">Collateral value:</div>
                    <div class="value">@movie.CollateralValue</div>
                </li>
            </ListContent>
        </CardItem>
    }
    
    <button class="btn-black btn-add w-100" @onclick="OpenNewMovieModal">Add New Movie</button>
</div>

<ModalComponent @bind-Show="_showEditModal" 
                Width="500px" 
                Height="400px">
    @if (_selectedMovie != null)
    {
        <div class="modal-content">
            <h4>@(_isNewMovie ? "Add New Movie" : "Edit Movie")</h4>
            
            <div class="form-group">
                <label>Title</label>
                <input @bind="_selectedMovie.Title" class="form-control" />
            </div>
            
            <div class="form-group">
                <label>Description</label>
                <textarea @bind="_selectedMovie.Description" class="form-control"></textarea>
            </div>
            
            <div class="form-group">
                <label>Price per day</label>
                <input @bind="_selectedMovie.PricePerDay" type="number" class="form-control" />
            </div>
            
            <div class="form-group">
                <label>Collateral value</label>
                <input @bind="_selectedMovie.CollateralValue" type="number" class="form-control" />
            </div>
            
            <div class="modal-actions">
                <button class="btn-primary" @onclick="HandleMovieSaved">Save</button>
                <button class="btn-secondary" @onclick="CloseEditModal">Cancel</button>
            </div>
        </div>
    }
</ModalComponent>

<ModalComponent @bind-Show="_showDeleteModal" 
                Width="400px" 
                Height="200px">
    @if (_selectedMovie != null)
    {
        <div class="modal-content">
            <h4>Confirm Delete</h4>
            <p>Are you sure you want to delete <strong>@_selectedMovie.Title</strong>?</p>
            
            <div class="modal-actions">
                <button class="btn-danger" @onclick="HandleDeleteConfirmed">Delete</button>
                <button class="btn-secondary" @onclick="CloseDeleteModal">Cancel</button>
            </div>
        </div>
    }
</ModalComponent>